<p>A <a href="http://stackoverflow.com/questions/2868862/newlines-in-the-immediate-window">question</a> came up recently on stack overflow concerning the display of newlines in the immediate window.&#160;&#160; The author noted that any .ToString method which contained a newline printed incorrectly when evaluated in the immediate window.&#160; For example given the following ToString implementation</p>  <pre class="code"><span style="color: blue">public override string </span>ToString() {
    <span style="color: blue">return </span><span style="color: #a31515">&quot;Hello&quot; </span>+ <span style="color: #2b91af">Environment</span>.NewLine + <span style="color: #a31515">&quot;World&quot;</span>;
}</pre>
<a href="http://11011.net/software/vspaste"></a>The immediate window would display the following.&#160; Noticed how the newline was printed as the actual escape sequence instead of a physical newline.&#160; <p><a href="http://blogs.msdn.com/cfs-file.ashx/__key/CommunityServer-Blogs-Components-WeblogFiles/00-00-00-39-97-metablogapi/7534.image5_5F00_010190B3.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://blogs.msdn.com/cfs-file.ashx/__key/CommunityServer-Blogs-Components-WeblogFiles/00-00-00-39-97-metablogapi/1754.image5_5F00_thumb_5F00_3FF3114E.png" width="479" height="129" /></a> </p>

<p>This behavior is not limited to ToString calls but will occur for any place an expression evaluates to a raw string.&#160;&#160; This behavior in the immediate window case is a fallout from the architecture of the debugger components.&#160; </p>

<p>The current level of fidelity in the debugger APIs prevent the expression evaluator from knowing which window it is providing data for.&#160; It is simply asked to evaluate expressions and provide data with very little in the way of context.&#160; In some ways this is a good thing because it trims down the number of scenarios to test because it limits the number of ways it is produced.&#160; The downside of course is that data provided must be able to work in every window and hence a bit more generic.&#160; Often times this leads to trade offs in how data is formatted. </p>

<p>Newlines are one of the places where a trade off was made.&#160; The immediate window is unique in that it’s the only window in the debugger where the default display contains multiple lines.&#160; Every other window (watch, locals, autos, etc …) contains a single line for display.&#160; Attempting to display a multiline string in a single line results in either having only the first or last line be visible.&#160; Hence the expression evaluators chose to escape the newlines to make more of the string visible in the majority scenario [1]</p>

<p>In the case this happens there is a built-in debugger visualizer which allows for the string to be displayed without any escaping.&#160; Simple click on the magnifying glass and select the Text Visualizer option.&#160; This pops up a modal dialog displaying the string in an unaltered form</p>

<p>&#160;<a href="http://blogs.msdn.com/cfs-file.ashx/__key/CommunityServer-Blogs-Components-WeblogFiles/00-00-00-39-97-metablogapi/6064.image_5F00_5882AE9E.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://blogs.msdn.com/cfs-file.ashx/__key/CommunityServer-Blogs-Components-WeblogFiles/00-00-00-39-97-metablogapi/4745.image_5F00_thumb_5F00_25B2A82A.png" width="479" height="115" /></a> </p>

<p><a href="http://blogs.msdn.com/cfs-file.ashx/__key/CommunityServer-Blogs-Components-WeblogFiles/00-00-00-39-97-metablogapi/7558.image_5F00_0B723F06.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://blogs.msdn.com/cfs-file.ashx/__key/CommunityServer-Blogs-Components-WeblogFiles/00-00-00-39-97-metablogapi/4747.image_5F00_thumb_5F00_210C77A3.png" width="267" height="267" /></a> </p>

<p>[1] This escaping does not always happen.&#160; Essentially only when the data is specifically typed to a System.String</p><div style="clear:both;"></div></div>
    