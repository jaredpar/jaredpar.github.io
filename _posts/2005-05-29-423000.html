<P>A week ago, I blogged about how to register COM objects as LUA (<a href="http://blogs.msdn.com/jaredpar/archive/2005/05/17/418780.aspx">http://blogs.msdn.com/jaredpar/archive/2005/05/17/418780.aspx</A>).&nbsp; This is a follow up post, to show you how to alter your standard ATL registration code so that your DLL will register for the current user instead of for the machine.&nbsp; </P>
<P>This code uses the RegOverridePreDefKey() method to override HKCR with the registration point for the current user (HKCU\Software\Classes).&nbsp; </P><FONT color=#ff0000 size=1>
<P>// DllRegisterServer - Adds entries to the system registry </FONT><BR><FONT size=1>STDAPI DllRegisterServer(</FONT><FONT color=#0000ff size=1>void</FONT><FONT size=1>)</FONT><BR><FONT size=1>{ </FONT><BR><FONT color=#ff0000 size=1>// registers object, typelib and all interfaces in typelib for the current user</FONT><BR><FONT size=1>HKEY key; </FONT><BR><FONT color=#0000ff size=1>if</FONT><FONT size=1> ( ERROR_SUCCESS != ::RegOpenKeyW(HKEY_CURRENT_USER, L"Software\\Classes", &amp;key) )<BR>{ </FONT><BR><FONT color=#0000ff size=1>return</FONT><FONT size=1> E_FAIL; <BR>} </FONT><BR><FONT color=#0000ff size=1>if</FONT><FONT size=1> ( ERROR_SUCCESS != ::RegOverridePredefKey(HKEY_CLASSES_ROOT, key) )<BR>{ </FONT><BR><FONT size=1>::RegCloseKey(key); </FONT><BR><FONT color=#0000ff size=1>return</FONT><FONT size=1> E_FAIL; <BR>} <BR>HRESULT hr = _AtlModule.RegisterServer(</FONT><FONT color=#0000ff size=1>true</FONT><FONT size=1>); <BR>::RegCloseKey(key); </FONT><BR><FONT color=#0000ff size=1>return</FONT><FONT size=1> hr; <BR>}</FONT> </P>
<P>"This posting is provided "AS IS" with no warranties, and confers no rights"</P><div style="clear:both;"></div></div>
    