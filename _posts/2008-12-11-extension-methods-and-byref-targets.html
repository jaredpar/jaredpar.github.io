<p>One of the seldom used, and often unknown, features of VB extension methods is that the argument of the extension method (the first parameter) can be passed by reference.&#160; This gives extension methods the power to change the reference that was used to invoke the value!&#160; </p>  <p>Obviously this can produce unexpected but often amusing behavior.&#160; The following sample prints “False”.</p>  <pre class="code">    &lt;Extension()&gt; _
    <span style="color: blue">Public Sub </span>EnsureNotNull(<span style="color: blue">ByRef </span>str <span style="color: blue">As String</span>)
        <span style="color: blue">If </span>str <span style="color: blue">Is Nothing Then
            </span>str = <span style="color: blue">String</span>.Empty
        <span style="color: blue">End If
    End Sub

    Sub </span>Example(<span style="color: blue">ByVal </span>p1 <span style="color: blue">As String</span>)
        p1.EnsureNotNull()
        Console.WriteLine(<span style="color: #a31515">&quot;{0}&quot;</span>, p1 <span style="color: blue">Is Nothing</span>)
    <span style="color: blue">End Sub

    Sub </span>Main()
        Example(<span style="color: blue">Nothing</span>)
    <span style="color: blue">End Sub
</span></pre>

<p>I think people will look at this example and either cringe, call it terrible code or get excited.&#160; Personally I’m somewhere between cringing and getting excited (in fact I’m doing both).&#160; But before people think I’ve gone off the deep end I don’t plan on checking this in any time soon (and yes I think it’s a bad idea).</p>

<p>Why?&#160; The feature is fun to play with and can create some interesting samples but it can also just as easily lead to very bad and unanticipated behavior.&#160; For instance what if instead of making sure something wasn’t Nothing, the code made the argument Nothing?&#160; </p>

<pre class="code">&lt;Extension()&gt; _
<span style="color: blue">Sub </span>EvilMethod(<span style="color: blue">ByRef </span>p1 <span style="color: blue">As Object</span>)
    p1 = <span style="color: blue">Nothing
End Sub

Sub </span>Example2()
    <span style="color: blue">Dim </span>s <span style="color: blue">As New </span>Student()
    s.PrintClass()
    s.EvilMethod()
    s.PrintName()   <span style="color: green">' Causes a NullReferenceException
</span><span style="color: blue">End Sub</span></pre>
<a href="http://11011.net/software/vspaste"></a>The code runs and throws an exception.&#160; A developer attaches a debugger, looks at the exception but immediately notes there are 2 other method calls just above.&#160; How could they succeed but the last throw a NullReferenceException???&#160; Certainly this may be a fun joke but in production code a fellow developer would not be amused.&#160; <p>More importantly though the behavior when passing an extension method target by reference is flat out unexpected.&#160; Who expects what appears to an instance method call to be able to modify “Me/this?”&#160; Probably not too many people.&#160; Coding is difficult enough without creating patterns that will blow away anyone who owns your code down the line.&#160; Code should do it’s best to be clear and produce predictable results.</p>

<p>Still, an interesting feature to toy with. </p></div>
    