<p>Reference values are a powerful feature of C++ but I find they have one significant detractor.&nbsp; A developer can not look at an API call and determine if a parameter is being passed by reference or value (VB has the same problem).&nbsp; </p> <p>IMHO this is one item that C# got 100% correct.&nbsp; In C# developers must say a value is out/ref or a compile error results.&nbsp; Forcing both the API declaration and usage to specify the reference semantics makes code much more understandable.&nbsp; When you look at an API call there is absolutely no question about the byref/byval/out semantics of a parameter.&nbsp; </p> <p>Internally I've met people who are hesitant to use reference parameters in C++ because of the ambiguity.&nbsp; Not making it declarative in both places meant unexpected behavior could occur in a number of scenarios.&nbsp; I agree with this statement.&nbsp; </p> <p>But hey we're talking about C++ here.&nbsp; Any C++ problem can be fixed with some macros and a template right?&nbsp; I thought about this over the weekend and came up with a quick sample.&nbsp; Note, I haven't extensively tested this sample yet so there may be bugs.&nbsp; However it gets the base cases right.</p> <p>The goal of this API is to allow API authors to force developers to be explicit about their ByRef semantics.&nbsp; It will prevent developers from silently passing a value by ref and hence getting unexpected behavior.&nbsp; Failure to do so will result in a compile time error.&nbsp; Also there is a minor bit of indirection overhead for debug mode but in retail this will compile out to normal code.&nbsp; </p><pre class="code"><span style="color: rgb(0,0,255)">#ifdef</span> DEBUG

<span style="color: rgb(0,0,255)">template</span> &lt;<span style="color: rgb(0,0,255)">typename</span> T&gt;
<span style="color: rgb(0,0,255)">class</span> ByRefType
{
<span style="color: rgb(0,0,255)">public</span>:
    <span style="color: rgb(0,0,255)">explicit</span> ByRefType(T&amp; arg) : m_ref(arg)
    {
    }

    <span style="color: rgb(0,0,255)">operator</span> T&amp;() <span style="color: rgb(0,0,255)">const</span> 
    {
        <span style="color: rgb(0,0,255)">return</span> m_ref;
    }

    ByRefType&amp; <span style="color: rgb(0,0,255)">operator</span>=(<span style="color: rgb(0,0,255)">const</span> T&amp; value)
    {
        m_ref = value;
        <span style="color: rgb(0,0,255)">return</span> *<span style="color: rgb(0,0,255)">this</span>;
    }

<span style="color: rgb(0,0,255)">private</span>:
    ByRefType();

    <span style="color: rgb(0,0,255)">mutable</span> T&amp; m_ref;
};

<span style="color: rgb(0,0,255)">template</span> &lt;<span style="color: rgb(0,0,255)">typename</span> T&gt;
ByRefType&lt;T&gt; MakeByRefType(T&amp; expr)
{
    <span style="color: rgb(0,0,255)">return</span> ByRefType&lt;T&gt;(expr);
}

<span style="color: rgb(0,0,255)">#define</span> ByRef(expr) MakeByRefType(expr)
<span style="color: rgb(0,0,255)">#define</span> ByRefParam(type) ByRefType&lt;type&gt; 

<span style="color: rgb(0,0,255)">#else

</span><span style="color: rgb(128,128,128)">#define ByRef(expr) expr
#define ByRefParam(type) type&amp;

</span><span style="color: rgb(0,0,255)">#endif</span></pre><a href="http://11011.net/software/vspaste"></a>
<p>All well and good.&nbsp; Now we can attribute byref paramaters with ByRefParam() and force callers to tag it as a ByRef argument.</p><pre class="code"><span style="color: rgb(0,0,255)">void</span> SimpleByRef(ByRefParam(<span style="color: rgb(0,0,255)">int</span>) i, <span style="color: rgb(0,0,255)">int</span> newValue)
{
    i = newValue;
}

<span style="color: rgb(0,0,255)">void</span> Test()
{
    <span style="color: rgb(0,0,255)">int</span> i1;
    SimpleByRef(ByRef(i1), 5);
    SimpleByRef(i1, 6);     <span style="color: rgb(0,128,0)">// Compiler Error!!!
</span>}</pre>As said before, this is an initial implementation and I expect updates as I use this in code and find bugs.&nbsp; Please post back with any you find.</div>
    