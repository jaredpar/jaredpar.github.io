<P>One action I find frustrating in C# is where a particular action needs to be taken based off of the type of a particular object.&nbsp; Ideally I would like to solve this with a switch statement but switch statements only support constant expressions in C# so no luck there.&nbsp; Previously I've had to resort to ugly looking code like the following.&nbsp; </P><PRE class=code><SPAN style="COLOR: #2b91af">Type </SPAN>t = sender.GetType();
<SPAN style="COLOR: blue">if </SPAN>(t == <SPAN style="COLOR: blue">typeof</SPAN>(<SPAN style="COLOR: #2b91af">Button</SPAN>)) {
    <SPAN style="COLOR: blue">var </SPAN>realObj = (<SPAN style="COLOR: #2b91af">Button</SPAN>)sender;
    <SPAN style="COLOR: green">// Do Something
</SPAN>}
<SPAN style="COLOR: blue">else if </SPAN>(t == <SPAN style="COLOR: blue">typeof</SPAN>(<SPAN style="COLOR: #2b91af">CheckBox</SPAN>)) {
    <SPAN style="COLOR: blue">var </SPAN>realObj = (<SPAN style="COLOR: #2b91af">CheckBox</SPAN>)sender;
    <SPAN style="COLOR: green">// Do something else
</SPAN>}
<SPAN style="COLOR: blue">else </SPAN>{
    <SPAN style="COLOR: green">// Default action
</SPAN>}</PRE><A href="http://11011.net/software/vspaste" mce_href="http://11011.net/software/vspaste"></A>
<P>Yes I realize this isn't the ugliest code but it seems less elegant to me over a standard switch statement and I find the casting tedious.&nbsp; Especially since it requires you to write every type twice.&nbsp; </P>
<P>What I want to say is "Given this type, execute this block of code."&nbsp; So I decided to run with that this afternoon.&nbsp; Lambdas will serve nicely for the block of code and using type inference will allow us to avoid writing every type out twice.&nbsp; What I ended up with was a class called TypeSwitch with 3 main methods (see bottom of post for full code).</P>
<UL>
<LI>Do - Entry point where switching begins </LI>
<LI>Case - Several overloads which take a generic type argument and an Action&lt;T&gt; to run for the object </LI>
<LI>Default - Optional default action.&nbsp; </LI></UL>
<P>I wrote a quick winforms app to test out the solution.&nbsp; I dropped some random controls on a from and bound the MouseHover event for all of them to a single method.&nbsp; I can now use the following code to print out different messages based on the type.&nbsp; </P><PRE class=code><SPAN style="COLOR: #2b91af">TypeSwitch</SPAN>.Do(
    sender,
    <SPAN style="COLOR: #2b91af">TypeSwitch</SPAN>.Case&lt;<SPAN style="COLOR: #2b91af">Button</SPAN>&gt;(() =&gt; textBox1.Text = <SPAN style="COLOR: #a31515">"Hit a Button"</SPAN>),
    <SPAN style="COLOR: #2b91af">TypeSwitch</SPAN>.Case&lt;<SPAN style="COLOR: #2b91af">CheckBox</SPAN>&gt;(x =&gt; textBox1.Text = <SPAN style="COLOR: #a31515">"Checkbox is " </SPAN>+ x.Checked),
    <SPAN style="COLOR: #2b91af">TypeSwitch</SPAN>.Default(() =&gt; textBox1.Text = <SPAN style="COLOR: #a31515">"Not sure what is hovered over"</SPAN>));</PRE><A href="http://11011.net/software/vspaste" mce_href="http://11011.net/software/vspaste"></A><PRE class=code><SPAN style="COLOR: blue"></SPAN></PRE>
<P>Notice that for check box I was able to access CheckBox properties in a strongly typed fashion.&nbsp; The underlying case code will optionally pass the first argument to the lambda expression strongly typed to the value specified as the generic argument.&nbsp; </P>
<P>There are a couple of faults with this approach including Default being anywhere in the list but it was a fun experiment and works well.&nbsp; </P>
<P>TypeSwitch code.</P><PRE class=code><SPAN style="COLOR: blue">static class </SPAN><SPAN style="COLOR: #2b91af">TypeSwitch </SPAN>{
    <SPAN style="COLOR: blue">public class </SPAN><SPAN style="COLOR: #2b91af">CaseInfo </SPAN>{
        <SPAN style="COLOR: blue">public bool </SPAN>IsDefault { <SPAN style="COLOR: blue">get</SPAN>; <SPAN style="COLOR: blue">set</SPAN>; }
        <SPAN style="COLOR: blue">public </SPAN><SPAN style="COLOR: #2b91af">Type </SPAN>Target { <SPAN style="COLOR: blue">get</SPAN>; <SPAN style="COLOR: blue">set</SPAN>; }
        <SPAN style="COLOR: blue">public </SPAN><SPAN style="COLOR: #2b91af">Action</SPAN>&lt;<SPAN style="COLOR: blue">object</SPAN>&gt; Action { <SPAN style="COLOR: blue">get</SPAN>; <SPAN style="COLOR: blue">set</SPAN>; }
    }

    <SPAN style="COLOR: blue">public static void </SPAN>Do(<SPAN style="COLOR: blue">object </SPAN>source, <SPAN style="COLOR: blue">params </SPAN><SPAN style="COLOR: #2b91af">CaseInfo</SPAN>[] cases) {
        <SPAN style="COLOR: blue">var </SPAN>type = source.GetType();
        <SPAN style="COLOR: blue">foreach </SPAN>(<SPAN style="COLOR: blue">var </SPAN>entry <SPAN style="COLOR: blue">in </SPAN>cases) {
            <SPAN style="COLOR: blue">if </SPAN>(entry.IsDefault || type == entry.Target) {
                entry.Action(source);
                <SPAN style="COLOR: blue">break</SPAN>;
            }
        }
    }

    <SPAN style="COLOR: blue">public static </SPAN><SPAN style="COLOR: #2b91af">CaseInfo </SPAN>Case&lt;T&gt;(<SPAN style="COLOR: #2b91af">Action </SPAN>action) {
        <SPAN style="COLOR: blue">return new </SPAN><SPAN style="COLOR: #2b91af">CaseInfo</SPAN>() {
            Action = x =&gt; action(),
            Target = <SPAN style="COLOR: blue">typeof</SPAN>(T)
        };
    }

    <SPAN style="COLOR: blue">public static </SPAN><SPAN style="COLOR: #2b91af">CaseInfo </SPAN>Case&lt;T&gt;(<SPAN style="COLOR: #2b91af">Action</SPAN>&lt;T&gt; action) {
        <SPAN style="COLOR: blue">return new </SPAN><SPAN style="COLOR: #2b91af">CaseInfo</SPAN>() {
            Action = (x) =&gt; action((T)x),
            Target = <SPAN style="COLOR: blue">typeof</SPAN>(T)
        };
    }

    <SPAN style="COLOR: blue">public static </SPAN><SPAN style="COLOR: #2b91af">CaseInfo </SPAN>Default(<SPAN style="COLOR: #2b91af">Action </SPAN>action) {
        <SPAN style="COLOR: blue">return new </SPAN><SPAN style="COLOR: #2b91af">CaseInfo</SPAN>() {
            Action = x =&gt; action(),
            IsDefault = <SPAN style="COLOR: blue">true
        </SPAN>};
    }
}</PRE><A href="http://11011.net/software/vspaste" mce_href="http://11011.net/software/vspaste"></A></div>
    