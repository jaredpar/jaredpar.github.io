<P>A frequent question that pops up on newsgroups such as microsoft.dotnet.framework.interop is how to Marshal nested structures (and arrays of nested structures) via P/Invoke.&nbsp; The documentation on the subject that I have found usually only covers structures that&nbsp;defined in the UnmanagedType enumeration&nbsp;and just touch on the idea of structures containing nested arrays of custom structures.&nbsp; Part of the reason is that the explinations for these problems is quite involed and scenario specific.&nbsp; After answering it a few times I decided to make a multi part blog post on the subject.&nbsp; This will consist of at least 4 entries (might add some more if something comes up).&nbsp; </P>
<P>Index</P>
<UL>
<LI><A href="http://blogs.msdn.com/jaredpar/archive/2005/07/12/437686.aspx" mce_href="http://blogs.msdn.com/jaredpar/archive/2005/07/12/437686.aspx">Part Two</A> 
<LI><A href="http://blogs.msdn.com/jaredpar/archive/2005/07/14/439024.aspx" mce_href="http://blogs.msdn.com/jaredpar/archive/2005/07/14/439024.aspx">Part Three</A> 
<LI><A href="http://blogs.msdn.com/jaredpar/archive/2005/07/18/439457.aspx" mce_href="http://blogs.msdn.com/jaredpar/archive/2005/07/18/439457.aspx">Part Four</A></LI></UL>
<P>The first installment is just going to be laying out our Native data structures that will be used throughout this series.&nbsp; I'm going to use a generic(and quite contrived) university classroom examle.&nbsp; Here are the C struct definitions and a couple of functions that I will be using.&nbsp; </P><PRE>struct Student 
{ 
  WCHAR FirstName[10]; 
  WCHAR LastName[10]; 
  int BirthDay; 
  int BirthMonth; 
  int BirthYear; 
}; 

struct Course{ 
  int Id; 
  int Count; 
  Student Students[5]; 
}; 

	// Create a student with the specified information.  Returned structure should be freed with 
	// GlobalFree
__declspec(dllexport) Student* CreateStudent(
    LPCWSTR firstName, 
    LPCWSTR lastName, 
    int bDay, 
    int bMon, 
    int bYear)

	// Update an existing student with the specified information
__declspec(dllexport) void UpdateStudentInfo(
    LPCWSTR firstName, 
    LPCWSTR lastName, 
    int bDay, 
    int bMon, 
    int bYear, 
    Student *student)

	// Get information for a particurlar course.  Returned structure should be freed with 
	// GlobalFree
__declspec(dllexport) Course *GetCourseInfo(int courseId)

</PRE>
<P>The environment I am coding and testing my fixes in is Microsoft Visual Studio 2005 Beta 2. All of these examples should work in all versions of Visual Studio though.&nbsp; If you find an inconsistencies please let me know.&nbsp; All native examples will also be in Unicode.&nbsp; </P>
<P><FONT size=2>This posting is provided "AS IS" with no warranties, and confers no rights. <BR>Use of included script samples are subject to the terms specified at </FONT><A title=http href="http://www.microsoft.com/info/cpyright.htm" mce_href="http://www.microsoft.com/info/cpyright.htm"><FONT face=Verdana color=#223355 size=2><STRONG>http://www.microsoft.com/info/cpyright.htm</STRONG></FONT></A><FONT face=Verdana size=2>.</FONT></P><div style="clear:both;"></div></div>
    