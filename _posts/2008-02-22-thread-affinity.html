<p>Part of creating a multithreading program is understanding which threads objects live on.&#160; Seems simple enough and typically is.&#160; However it's nice to insert guarantees to match the design. </p>  <p>One type of threading model is for objects or subsets of methods in an object to have an affinity to a particular thread.&#160; Meaning that those methods can only be validly called on a particular thread and no other.&#160; I create a small helper object to help validate this affinity.&#160; </p>  <p>Simple, but gets the job done. </p>  <pre class="code">    [<span style="color: rgb(43,145,175)">Immutable</span>]
    <span style="color: rgb(0,0,255)">public</span> <span style="color: rgb(0,0,255)">sealed</span> <span style="color: rgb(0,0,255)">class</span> <span style="color: rgb(43,145,175)">ThreadAffinity
</span>    {
        <span style="color: rgb(0,0,255)">private</span> <span style="color: rgb(0,0,255)">readonly</span> <span style="color: rgb(0,0,255)">int</span> m_threadId;

        <span style="color: rgb(0,0,255)">public</span> ThreadAffinity()
        {
            m_threadId = <span style="color: rgb(43,145,175)">Thread</span>.CurrentThread.ManagedThreadId;
        }

        <span style="color: rgb(0,0,255)">public</span> <span style="color: rgb(0,0,255)">void</span> Check()
        {
            <span style="color: rgb(0,0,255)">if</span> (<span style="color: rgb(43,145,175)">Thread</span>.CurrentThread.ManagedThreadId != m_threadId)
            {
                <span style="color: rgb(0,0,255)">var</span> msg = <span style="color: rgb(43,145,175)">String</span>.Format(
                    <span style="color: rgb(163,21,21)">&quot;Call to class with affinity to thread {0} detected from thread {1}.&quot;</span>,
                    m_threadId,
                    <span style="color: rgb(43,145,175)">Thread</span>.CurrentThread.ManagedThreadId);
                <span style="color: rgb(0,0,255)">throw</span> <span style="color: rgb(0,0,255)">new</span> <span style="color: rgb(43,145,175)">InvalidOperationException</span>(msg);
            }
        }
    }</pre>
<a href="http://11011.net/software/vspaste"></a></div>
    