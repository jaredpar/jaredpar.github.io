<p>This is a follow up for my <a href="http://blogs.msdn.com/jaredpar/archive/2007/10/16/c-new-operator-and-placement-new.aspx">previous post</a> about operator new and placement new.&nbsp; This post will discuss the role of adding a custom allocator and using it with new. </p> <p>It's handy to use custom allocators in C++.&nbsp; Certain operations can be done more efficiently on a different type of allocator than the rest of your program.&nbsp; It also allows you to add custom heap tracking, debugging, etc ...&nbsp; C++ also makes it very easy to use. </p> <p>The placement new operator already makes it fairly easy to use a custom allocator with your normal C++ syntax.&nbsp; For example, the bellow code snippet displays how to use a custom allocator with the placement new operator.&nbsp; You may or may not have to define the overloaded "new" depending on your code base.</p><pre class="code"><span style="color: rgb(0,0,255)">static</span> <span style="color: rgb(0,0,255)">inline
void</span> * <span style="color: rgb(0,0,255)">_cdecl</span> <span style="color: rgb(0,0,255)">operator</span> <span style="color: rgb(0,0,255)">new</span>(size_t cbSize, <span style="color: rgb(0,0,255)">void</span>* pv)
{
    <span style="color: rgb(0,0,255)">return</span> pv;
}

<span style="color: rgb(0,0,255)">void</span> SomeProcedure()
{
    MyCustomAllocator allocator;
    <span style="color: rgb(0,0,255)">void</span> *memory = allocator.Alloc(<span style="color: rgb(0,0,255)">sizeof</span>(Student));
    Student *p = <span style="color: rgb(0,0,255)">new</span> (memory) Student();
}</pre><a href="http://11011.net/software/vspaste"></a><font face="Courier New"></font>
<p>However this code is a bit clunky.&nbsp; It requires an extra local variable and an extra sizeof every time you want to use this pattern.&nbsp; You could eliminate the local by placing the allocation call directly within the new () arguments but for longer type names this would make your lines very long.&nbsp; </p>
<p>A more elegant solution is to further overload operator new.&nbsp; Don't forget it's just a normal function (with a few restrictions).&nbsp; That being said you can add an overload that takes in a reference to your allocation engine and perform the allocation inline.&nbsp; </p><pre class="code"><span style="color: rgb(0,0,255)">static</span> <span style="color: rgb(0,0,255)">inline
void</span> * <span style="color: rgb(0,0,255)">_cdecl</span> <span style="color: rgb(0,0,255)">operator</span> <span style="color: rgb(0,0,255)">new</span>(size_t cbSize, MyCustomAllocator &amp;allocator)
{
    <span style="color: rgb(0,0,255)">return</span> allocator.Alloc(cbSize);
}

<span style="color: rgb(0,0,255)">void</span> SomeOtherProcedure()
{
    MyCustomAllocator allocator;
    <span style="color: rgb(0,128,0)">// ...
</span>    Student *p = <span style="color: rgb(0,0,255)">new</span> (allocator) Student();
}</pre>
<p>This is much more elegant, removes the need for a local variable and only adds the length of the allocator name to your normal line length.&nbsp; </p></div>
    