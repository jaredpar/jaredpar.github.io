<p>Using <a href="http://research.microsoft.com/displayArticle.aspx?id=634">PreFast</a>&nbsp;internally we recently came across a class of bugs.&nbsp; In several places we were using uninitialized structures as local variables.&nbsp; The error came about because the types in question had no default constructor.&nbsp; For instance take the following structure </p><pre class="code"><span style="color: rgb(0,0,255)">struct</span> s1
{
    <span style="color: rgb(0,0,255)">int</span> m1;
    <span style="color: rgb(0,0,255)">int</span> m2;
};
</pre>
<p>This structure does not have a default constructor and hence the values for a local are not guaranteed to be any value.&nbsp; At first I thought this would be a simple fix.&nbsp; All I needed to do was add a default constructor that initializes the members to known values.&nbsp; At first I wondered why the original type author hadn't bothered to do this.&nbsp;&nbsp; </p><pre class="code">s1() : m1(0),m2(0) { }</pre>
<p><a href="http://11011.net/software/vspaste"></a>Now this looks well and good, I re-compile and get a whole lot of errors.&nbsp; It turns out that we have several unions defined for s1.&nbsp; </p><pre class="code">    <span style="color: rgb(0,0,255)">union</span> 
    {
        s1 u1;
        <span style="color: rgb(0,0,255)">int</span> u2;
    };</pre>
<p>It's not legal for a union member to have a non-trivial default constructor.&nbsp; The next solution is to use a C++ hack to initialize the variables on the stack.&nbsp; </p><pre class="code">s1 x = {0};</pre>
<p>I consider this a hack for a few reasons </p>
<ol>
<li>It only works if you need everything to be initialized to 0</li>
<li>It spreads out the logic for your type.&nbsp; Instead of being localized to the actual type definition code it's now spread out to the type use.&nbsp; </li>
<li>It's hard to maintain because if you ever add another member that requires different initialization you must update every single use of the type.&nbsp; Worst of all you can add said member and won't get a single error or warning about it. </li></ol>
<p>In the end for types where 0 didn't make sense we ended up using a factory pattern to initialize the variables.&nbsp; </p>
<p>All I wanted was a constructor.&nbsp; </p></div>
    