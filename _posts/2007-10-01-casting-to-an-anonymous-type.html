<P>This discussion is building upon a previous post on how to acquire an <A href="http://blogs.msdn.com/jaredpar/archive/2007/08/01/coding-quiz-anonymous-type-types.aspx" mce_href="http://blogs.msdn.com/jaredpar/archive/2007/08/01/coding-quiz-anonymous-type-types.aspx">anonymous type ... type</A>.&nbsp; </P>
<P>The next question is, how can you cast an arbitrary object into an anonymous type?&nbsp; At a glance this doesn't seem possible as you cannot directly express the type of an anonymous type in code.&nbsp; For instance the following code is not legal.&nbsp; </P><PRE class=code> <SPAN style="COLOR: rgb(0,0,255)">Dim</SPAN> o <SPAN style="COLOR: rgb(0,0,255)">As</SPAN> <SPAN style="COLOR: rgb(0,0,255)">Object</SPAN> = SomeCall() 
<SPAN style="COLOR: rgb(0,0,255)">Dim</SPAN> x = <SPAN style="COLOR: rgb(0,0,255)">Directcast</SPAN>(o, <SPAN style="COLOR: rgb(0,0,255)">New</SPAN> <SPAN style="COLOR: rgb(0,0,255)">With</SPAN> {.a = 5})</PRE><A href="http://11011.net/software/vspaste" mce_href="http://11011.net/software/vspaste"></A>
<P>Even though it's not possible to directly express the type in code, we can indirectly express it via type inference.&nbsp; Anonymous Types are strongly typed in the compiler and it is possible to infer these types where inference is available.&nbsp; </P><PRE class=code> <SPAN style="COLOR: rgb(0,0,255)">Public</SPAN> <SPAN style="COLOR: rgb(0,0,255)">Function</SPAN> CastSpecial(<SPAN style="COLOR: rgb(0,0,255)">Of</SPAN> T)(<SPAN style="COLOR: rgb(0,0,255)">ByVal</SPAN> o <SPAN style="COLOR: rgb(0,0,255)">As</SPAN> <SPAN style="COLOR: rgb(0,0,255)">Object</SPAN>, <SPAN style="COLOR: rgb(0,0,255)">ByVal</SPAN> t <SPAN style="COLOR: rgb(0,0,255)">As</SPAN> T) <SPAN style="COLOR: rgb(0,0,255)">As</SPAN> T 
<SPAN style="COLOR: rgb(0,0,255)">    Return</SPAN> <SPAN style="COLOR: rgb(0,0,255)">DirectCast</SPAN>(o, T)
<SPAN style="COLOR: rgb(0,0,255)"> End</SPAN> <SPAN style="COLOR: rgb(0,0,255)">Function </SPAN></PRE><A href="http://11011.net/software/vspaste" mce_href="http://11011.net/software/vspaste"></A>
<P>The above function allows us to perform a DirectCast as long as we have an instance of the type we want to cast to.&nbsp; Now we can call the code and passing in the appropriate anonymous type instance.</P><PRE class=code> <SPAN style="COLOR: rgb(0,0,255)">Dim</SPAN> o <SPAN style="COLOR: rgb(0,0,255)">As</SPAN> <SPAN style="COLOR: rgb(0,0,255)">Object</SPAN> = SomeCall()
<SPAN style="COLOR: rgb(0,0,255)"> Dim</SPAN> x = CastSpecial(o, <SPAN style="COLOR: rgb(0,0,255)">New</SPAN> <SPAN style="COLOR: rgb(0,0,255)">With</SPAN> {.a = 5})</PRE>
<P>There are a couple of caveats to this approach though.&nbsp; </P>
<OL>
<LI>The actual anonymous type and the one you are casting to must be exactly the same.&nbsp; No polymorphism can be involved.</LI>
<LI>The anonymous type must be created in the same assembly where you are performing the cast.&nbsp; Anonymous types are specific to the assembly they are created in so performing the cast accross assemblies will cause a InvalidCastException to occur.</LI>
<LI>It does needlessly create an object to perform the cast.</LI></OL></div>
    