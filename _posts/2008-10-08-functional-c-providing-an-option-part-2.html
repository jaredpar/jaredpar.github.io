<p>In my <a href="http://blogs.msdn.com/jaredpar/archive/2008/10/06/functional-c-providing-an-option.aspx">previous post</a> I discussed creating an Option style construct for C#/.Net.&#160; This post is a followup with the complete code snippet.&#160; It’s been updated in response to several bits of feedback I received.&#160; Namely</p>  <ol>   <li>Option is now a struct vs. class </li>    <li>Added equality metrics </li>    <li>Allowing implicit conversion T –&gt; Option&lt;T&gt;</li> </ol>  <p>As usual, this is available in the latest version of RantPack: <a title="http://code.msdn.microsoft.com/RantPack" href="http://code.msdn.microsoft.com/RantPack">http://code.msdn.microsoft.com/RantPack</a></p> <a href="http://11011.net/software/vspaste"></a>  <p><font face="Courier New"></font></p>  <pre class="code">[<span style="color: #2b91af">Immutable</span>]
[<span style="color: #2b91af">Serializable</span>]
[<span style="color: #2b91af">SuppressMessage</span>(<span style="color: #a31515">&quot;Microsoft.Naming&quot;</span>, <span style="color: #a31515">&quot;CA1716&quot;</span>)]
<span style="color: blue">public struct </span><span style="color: #2b91af">Option</span>&lt;T&gt; : <span style="color: #2b91af">IEquatable</span>&lt;<span style="color: #2b91af">Option</span>&lt;T&gt;&gt;
{
    <span style="color: blue">private readonly </span>T m_value;
    <span style="color: blue">private readonly bool </span>m_hasValue;

    <span style="color: blue">public static </span><span style="color: #2b91af">Option</span>&lt;T&gt; Empty
    {
        <span style="color: blue">get </span>{ <span style="color: blue">return new </span><span style="color: #2b91af">Option</span>&lt;T&gt;(); }
    }

    <span style="color: blue">public bool </span>HasValue
    {
        <span style="color: blue">get </span>{ <span style="color: blue">return </span>m_hasValue; }
    }

    [<span style="color: #2b91af">DebuggerDisplay</span>(<span style="color: #a31515">&quot;m_value&quot;</span>)]
    <span style="color: blue">public </span>T Value
    {
        <span style="color: blue">get
        </span>{
            <span style="color: blue">if </span>(!HasValue)
            {
                <span style="color: blue">throw new </span><span style="color: #2b91af">InvalidOperationException</span>(<span style="color: #a31515">&quot;Option does not have a value&quot;</span>);
            }

            <span style="color: blue">return </span>m_value;
        }
    }

    <span style="color: blue">public </span>T ValueOrDefault
    {
        <span style="color: blue">get </span>{ <span style="color: blue">return </span>m_hasValue ? m_value : <span style="color: blue">default</span>(T); }
    }

    <span style="color: blue">public </span>Option(T value)
    {
        m_hasValue = <span style="color: blue">true</span>;
        m_value = value;
    }

    <span style="color: blue">#region </span>Operators

    [<span style="color: #2b91af">SuppressMessage</span>(<span style="color: #a31515">&quot;Microsoft.Usage&quot;</span>, <span style="color: #a31515">&quot;CA1801&quot;</span>)]
    [<span style="color: #2b91af">SuppressMessage</span>(<span style="color: #a31515">&quot;Microsoft.Usage&quot;</span>, <span style="color: #a31515">&quot;CA2225&quot;</span>)]
    <span style="color: blue">public static implicit operator </span><span style="color: #2b91af">Option</span>&lt;T&gt;(<span style="color: #2b91af">Option </span>option)
    {
        <span style="color: blue">return </span><span style="color: #2b91af">Option</span>&lt;T&gt;.Empty;
    }

    [<span style="color: #2b91af">SuppressMessage</span>(<span style="color: #a31515">&quot;Microsoft.Usage&quot;</span>, <span style="color: #a31515">&quot;CA1801&quot;</span>)]
    <span style="color: blue">public static implicit operator </span><span style="color: #2b91af">Option</span>&lt;T&gt;(T value)
    {
        <span style="color: blue">return new </span><span style="color: #2b91af">Option</span>&lt;T&gt;(value);
    }

    <span style="color: blue">public static bool operator </span>==(<span style="color: #2b91af">Option</span>&lt;T&gt; left, <span style="color: #2b91af">Option</span>&lt;T&gt; right)
    {
        <span style="color: blue">return </span>left.Equals(right);
    }
    <span style="color: blue">public static bool operator </span>!=(<span style="color: #2b91af">Option</span>&lt;T&gt; left, <span style="color: #2b91af">Option</span>&lt;T&gt; right)
    {
        <span style="color: blue">return </span>!left.Equals(right);
    }

    <span style="color: blue">#endregion

    #region </span>IEquatable&lt;T&gt; Members

    <span style="color: blue">public bool </span>Equals(<span style="color: #2b91af">Option</span>&lt;T&gt; other)
    {
        <span style="color: blue">if </span>(other.HasValue != <span style="color: blue">this</span>.HasValue)
        {
            <span style="color: blue">return false</span>;
        }

        <span style="color: green">// Both don't have a value
        </span><span style="color: blue">if </span>(!other.HasValue)
        {
            <span style="color: blue">return true</span>;
        }

        <span style="color: blue">return </span><span style="color: #2b91af">EqualityComparer</span>&lt;T&gt;.Default.Equals(m_value, other.Value);
    }

    <span style="color: blue">#endregion

    #region </span>Overrides

    <span style="color: blue">public override bool </span>Equals(<span style="color: blue">object </span>obj)
    {
        <span style="color: blue">if </span>(obj <span style="color: blue">is </span><span style="color: #2b91af">Option</span>&lt;T&gt;)
        {
            <span style="color: blue">return </span>Equals((<span style="color: #2b91af">Option</span>&lt;T&gt;)obj);
        }

        <span style="color: blue">return false</span>;
    }

    <span style="color: blue">public override int </span>GetHashCode()
    {
        <span style="color: blue">if </span>(!HasValue)
        {
            <span style="color: blue">return </span>0;
        }

        <span style="color: blue">return </span><span style="color: #2b91af">EqualityComparer</span>&lt;T&gt;.Default.GetHashCode(m_value);
    }

    <span style="color: blue">#endregion
</span>}

[<span style="color: #2b91af">Immutable</span>]
[<span style="color: #2b91af">Serializable</span>]
[<span style="color: #2b91af">SuppressMessage</span>(<span style="color: #a31515">&quot;Microsoft.Naming&quot;</span>, <span style="color: #a31515">&quot;CA1716&quot;</span>)]
<span style="color: blue">public sealed class </span><span style="color: #2b91af">Option
</span>{
    <span style="color: blue">private static </span><span style="color: #2b91af">Option </span>s_empty = <span style="color: blue">new </span><span style="color: #2b91af">Option</span>();

    <span style="color: blue">private </span>Option()
    {
    }

    <span style="color: blue">public static </span><span style="color: #2b91af">Option</span>&lt;T&gt; Create&lt;T&gt;(T value)
    {
        <span style="color: blue">return new </span><span style="color: #2b91af">Option</span>&lt;T&gt;(value);
    }

    <span style="color: blue">public static </span><span style="color: #2b91af">Option </span>Empty
    {
        <span style="color: blue">get </span>{ <span style="color: blue">return </span>s_empty; }
    }
}</pre>
<a href="http://11011.net/software/vspaste"></a></div>
    