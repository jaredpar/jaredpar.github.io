<DIV>COM interop is one of the messy places where error by return value vs exception meet head on.&nbsp; COM was built on the basis of HRESULT return values while .NET tends to use exceptions.&nbsp; To compensate for that, the CLR helps out by mapping failure HRESULTs into .NET exceptions during COM Interop.&nbsp; It does this by the following process</DIV>
<DIV>&nbsp;</DIV>
<DIV>&nbsp; 1) Discard the HRESULT return value</DIV>
<DIV>&nbsp; 2) Convert any [out, retval] components to the method return value </DIV>
<DIV>&nbsp;</DIV>
<DIV>This is helpful in a lot of cases.&nbsp; You can make you're COM calls happily and exceptions will be thrown when an error occurs.&nbsp; There are a lot of cases where this isn't enough information for the developer.&nbsp; The main one are the semi-successful HRESULT return values.&nbsp; The CLR will only throw exceptions for failed HRESULTS [1] but will not for values such as S_FALSE.&nbsp; </DIV>
<DIV>&nbsp;</DIV>
<DIV>Values such as S_FALSE hold a lot in certain COM components and cannot be ignored in many situations.&nbsp; But because the CLR disregards this value there is no way to get to that value via this method.&nbsp; To be able to access the HRESULT in COM component return values you have to turn off the exception mapping.&nbsp; Unfortunately you will not be able to use the type library importer for this. </DIV>
<DIV>&nbsp;</DIV>
<DIV>&nbsp; 1) Modify your Managed Interafec to match the COM signature (add the int,uint return value and readd the [out,retval] component to the paramaters).&nbsp; </DIV>
<DIV>&nbsp; 2) Decorate the method with the [PreserveSig] attribute.</DIV>
<DIV>&nbsp;</DIV>
<DIV>This will allow you to access the HRESULT for the return value good or bad.&nbsp; The downside is that the CLR will no longer translate bad HRESULTS into exceptions and your back to using SUCCEEDED and FAILED methods.</DIV>
<DIV>&nbsp;</DIV>
<DIV>List of Mapped HRESULTs to .NET Exceptions </DIV>
<DIV>&nbsp; <A href="http://msdn2.microsoft.com/en-us/library/9ztbc5s1">http://msdn2.microsoft.com/en-us/library/9ztbc5s1</A></DIV>
<DIV>&nbsp;</DIV>
<DIV>&nbsp;</DIV>
<DIV>[1] The documentation on MSDN says it will throw for anything but S_OK.&nbsp; You can verify that isn't correct by using a component that returns S_FALSE</DIV>
<DIV>&nbsp;</DIV>
<DIV>"This posting is provided "AS IS" with no warranties, and confers no rights"</DIV><div style="clear:both;"></div></div>
    