<p>This is a bit of a follow up to a <a href="http://blogs.msdn.com/jaredpar/archive/2008/04/28/properly-implementing-equality-in-vb.aspx">previous post</a> we discussed how to properly implement equality in VB.&nbsp; Several users commented/asked that <a href="http://msdn.microsoft.com/en-us/library/ms131187(VS.80).aspx">IEquatable(Of T)</a> could be used in place of overriding Equals().&nbsp; Since <a href="http://msdn.microsoft.com/en-us/library/ms131187(VS.80).aspx">IEquatable(Of T)</a>&nbsp; doesn't define a GetHashCode() method the user didn't need to define it and hence run into all of the problems associated with GetHashCode() usage.&nbsp; </p> <p>Unfortunately this is not the case.&nbsp; Several parts of the framework link IEquatable(Of T).Equals and Object.GetHashCode() in the same way that Object.Equals() and Object.GetHashCode() are linked. </p> <p>The prime example of this is <a href="http://msdn.microsoft.com/en-us/library/ms132123.aspx">EqualityComparer(Of T)</a>.&nbsp; This class is used to provide instances of IEqualityComparer(Of T) for any given type.&nbsp; Under the hood it tries to determine the best way checking for equality in types.&nbsp; If T implements IEquatable(Of T) it will eventually create an instance of GenericEqualityComparer(Of T) [1].&nbsp; The methods of IEqualityComparer(Of T) are implemented as follows (boundary cases removed)</p> <ul> <li>Equals(left, right): return left.Equals(right) </li> <ul> <li>Equals in this case is IEquatable(Of T).Equals</li></ul> <li>GetHashCode(obj): return obj.GetHashCode()</li></ul> <p>This implicitly links IEquatable(Of T).Equals to Object.GetHashCode().&nbsp; Therefore if you implement IEquatable(Of T) you should also override GetHashCode().&nbsp; The best way to view this is "if you implement IEquatable(Of T) you should override Equals and GetHashCode."</p> <p>What's even more unfortunate is there is no feedback to indicate this relationship exists.&nbsp; If you override Equals or GetHashCode both the C# and VB compilers will issue a warning/error.&nbsp; Implementing IEquatable(Of T) produces no such warning.&nbsp; </p> <p>[1] Unfortunately this is a private type so you will need to use Reflector to view the type.</p></div>
    